{% comment %} 2-column Delivery | Payment (with e-mail + success msg) {% endcomment %}

{% style %}
  /* Glove Selector Styles */
  .glove-selector-section {
    max-width: 1100px;
    margin: 0 auto 3rem;
    text-align: center;
  }
  
  .glove-selector-title {
    font-size: 2.4rem;
    margin-bottom: 1.5rem;
    font-weight: 700;
    color: #111;
  }
  
  .glove-options {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 1.2rem;
    margin-bottom: 2rem;
  }
  
  .glove-options input[type='radio'] {
    position: absolute;
    clip: rect(0 0 0 0);
    height: 1px;
    width: 1px;
    overflow: hidden;
  }
  
  .glove-options input[type='radio'] + label {
    position: relative;
    display: inline-block;
    padding: 1.6rem 3.2rem;
    font-size: 1.8rem;
    letter-spacing: 0.06rem;
    line-height: 1;
    text-align: center;
    border-radius: 999px;
    background: linear-gradient(to bottom, rgba(249, 249, 249, 0.95), rgba(234, 234, 234, 0.9));
    color: rgb(17, 17, 17);
    border: 1px solid rgba(17, 17, 17, 0.25);
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.3s ease;
    box-shadow: inset 0 1px 2px rgba(17, 17, 17, 0.08), 0 3px 8px rgba(0, 0, 0, 0.08);
  }
  
  .glove-options input[type='radio'] + label::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.15), rgba(0, 0, 0, 0.03));
    pointer-events: none;
    z-index: 0;
  }
  
  .glove-options input[type='radio']:hover + label {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12), inset 0 1px 2px rgba(17, 17, 17, 0.05);
    border-color: rgba(17, 17, 17, 0.6);
  }
  
  .glove-options input[type='radio']:checked + label {
    background: rgb(17, 17, 17);
    color: rgb(249, 249, 249);
    transform: scale(1.05);
    border-color: rgba(17, 17, 17, 0.8);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25), inset 0 1px 2px rgba(249, 249, 249, 0.25);
  }
  
  /* Image Gallery Styles */
  .glove-gallery {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1.5rem;
    margin-top: 2rem;
    max-width: 1100px;
    margin: 0 auto;
  }
  
  .glove-image {
    width: 100%;
    height: 260px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid #eee;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .glove-image:hover {
    transform: scale(1.03);
    border-color: #ddd;
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  }
  
  /* Lightbox Styles */
  .lightbox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .lightbox.active {
    display: flex;
  }
  
  .lightbox-content {
    max-width: 90%;
    max-height: 90%;
  }
  
  .lightbox-content img {
    max-width: 100%;
    max-height: 90vh;
    border-radius: 8px;
    box-shadow: 0 0 30px rgba(0,0,0,0.6);
  }
  
  .close-lightbox {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  
  .close-lightbox:hover {
    color: #bbb;
  }
  
  /* Form Styles */
  .crypto-two-col {
    display: grid;
    gap: 3rem;
    grid-template-columns: 1fr 1fr;
    max-width: 1100px;
    margin: 0 auto;
  }
  
  @media (max-width: 900px) {
    .crypto-two-col {
      grid-template-columns: 1fr;
    }
    
    .glove-gallery {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    .glove-image {
      height: 180px;
    }
  }
  
  .crypto-card {
    border: 1.5px solid #2d2346;
    background: #221a38;
    color: #f3f0ff;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 16px #0003;
  }
  
  .crypto-card h3 {
    margin-bottom: 1.2rem;
    font-size: 2rem;
    color: #a259ec;
    font-weight: 700;
  }
  
  .crypto-card .field {
    margin-bottom: 1.4rem;
  }
  
  .crypto-card .field--2up {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.4rem;
  }
  
  .crypto-card .field--2up .field {
    margin: 0;
  }
  
  .crypto-card input,
  .crypto-card textarea,
  .crypto-card select {
    width: 100%;
    padding: 1rem 1.2rem;
    border-radius: 8px;
    border: 1.5px solid #2d2346;
    background: #18122b;
    color: #f3f0ff;
    font-size: 1.1rem;
    margin-top: 0.3rem;
    margin-bottom: 0.7rem;
    transition: border 0.18s, background 0.18s;
  }
  
  .crypto-card input:focus,
  .crypto-card textarea:focus,
  .crypto-card select:focus {
    border: 1.5px solid #a259ec;
    outline: none;
    background: #221a38;
  }
  
  .crypto-card .button {
    width: 100%;
    margin-top: 1.8rem;
    background: #a259ec;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1.15rem;
    font-weight: 700;
    padding: 1.1rem 0;
    box-shadow: 0 2px 8px #a259ec33;
    cursor: pointer;
    transition: background 0.18s, box-shadow 0.18s;
  }
  
  .crypto-card .button:hover {
    background: #7c3aed;
    box-shadow: 0 4px 16px #7c3aed33;
  }
  
  .btn-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
  }
  
  /* Pick button crypto payment */
  .pick-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.1rem 2.2rem;
    font-size: 1.4rem;
    letter-spacing: 0.05rem;
    line-height: 1;
    font-family: 'Inter', 'Helvetica Neue', sans-serif;
    font-weight: 700;
    color: #222;
    border-radius: 8px;
    background: linear-gradient(to bottom, #f9f9f9, #dcdcdc);
    border: 1px solid #bbb;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), inset 0 1px 1px rgba(255, 255, 255, 0.8);
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  
  .pick-btn:hover {
    background: linear-gradient(to bottom, #e3e3e3, #c0c0c0);
    color: #111;
    border-color: #999;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), inset 0 1px 1px rgba(255, 255, 255, 0.9);
    transform: none;
  }
  
  .pick-btn.selected {
    background: linear-gradient(to bottom, #e3e3e3, #c0c0c0);
    color: #111;
    border-color: #999;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), inset 0 1px 1px rgba(255, 255, 255, 0.9);
    transform: none;
  }
  
  .pick-btn img {
    width: 26px;
    height: 26px;
    margin-right: 0.6rem;
  }
  
  .pick-btn:hover {
    border-color: #111;
  }
  
  .pick-btn.selected {
    border-color: #111;
    background: #f2f2f2;
  }
  
  .hidden {
    display: none;
  }
  
  .wallet-panel {
    margin-top: 1.6rem;
    border: 1px solid #ddd;
    padding: 1.2rem;
    border-radius: 8px;
    display: none;
  }
  
  .wallet-panel.show {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    flex-wrap: wrap;
  }
  
  .addr-pill {
    font-family: monospace;
    background: #fafafa;
    padding: 0.6rem 1rem;
    border-radius: 4px;
    word-break: break-all;
  }
  
  .amount-line {
    margin: 1rem 0 0;
    font-weight: 600;
  }
  
  .form-success {
    margin-top: 1.5rem;
    text-align: center;
    font-weight: 600;
    color: green;
  }
  
  .form-success::before {
    content: "✓";
    margin-right: 0.4rem;
    color: green;
    font-weight: 700;
  }
  
  /* Country select styles */
  select.field__input {
    padding-top: 0.9rem;
  }
  
  select.field__input {
    padding-top: 1.25rem;
    padding-bottom: 0.45rem;
    line-height: 1.45;
  }
  
  select.field__input.has-value + .field__label {
    transform: translateY(-1.4rem) scale(0.8);
    opacity: 0.7;
  }
  
  select#country.field__input {
    padding-top: 0.65rem;
    padding-bottom: 0.45rem;
    line-height: 1.45;
  }
  
  select#country.field__input + .field__label {
    transform: translateY(-1.4rem) scale(0.8);
    opacity: 0.7;
  }
  
  select#country.field__input + .field__label {
    display: none;
  }
  
  /* Crypto warning */
  .crypto-warning {
    background-color: #e6f9ec;
    border: 1px solid #4caf50;
    color: #1b5e20;
    padding: 1.2rem 1.5rem;
    border-radius: 8px;
    font-size: 1.3rem;
    line-height: 1.6;
    font-family: 'Inter', 'Helvetica Neue', sans-serif;
    margin-top: 1.5rem;
  }
  
 /* Optional text styling */
#apt::placeholder {
  font-size: 1.4rem;
}

/* Divider between form and viewer */
.section-divider {
  max-width: 100%;
  margin: 4rem auto;
  border-top: 1px solid #888888;
  padding-top: 1.2rem;
  text-align: center;
}

.section-divider-title {
  font-size: 2.4rem;
  font-weight: 700;
  color: #111;
  margin-bottom: 1.5rem;
}

/* Skin Viewer Styles */
.viewer-container {
  max-width: 700px;
  margin: 2.2rem auto 0;
  padding: 2.4rem;
  background: #f8f8f8;
  border-radius: 22px;
  box-shadow: 0 0 16px rgba(0, 0, 0, 0.1);
  border: 1px solid #d6d6d6;
  text-align: center;
}

.viewer-img {
  width: 100%;
  border-radius: 14px;
  border: 3.2px solid #d6d6d6;
  transition: transform 0.4s ease, opacity 0.3s ease;
  will-change: transform;
}

.viewer-img.animate {
  transform: scale(1.015);
}

.viewer-controls {
  margin-top: 1.6rem;
  display: flex;
  justify-content: center;
  gap: 2.4rem;
  font-size: 1.5rem;
  font-weight: 700;
  font-family: 'Inter', sans-serif;
}

.viewer-nav {
  background: linear-gradient(to right, #d6d6d6, #cfcfcf);
  border: 1px solid #111;
  border-radius: 999px;
  padding: 0.9rem 2rem;
  cursor: pointer;
  transition: all 0.25s ease;
  font-family: 'Inter', sans-serif;
  font-weight: 700;
}

.viewer-nav:hover:not(:disabled) {
  background: #111;
  color: #fff;
  transform: scale(1.05);
}

.viewer-nav:disabled {
  cursor: default;
  opacity: 0.4;
  transform: none;
}

.viewer-info-display {
  position: absolute;
  top: 50%;
  left: calc(50% + 380px);
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  font-size: 2.2rem;
  font-weight: 800;
  font-family: 'Inter', sans-serif;
  color: #111;
  text-align: left;
  white-space: nowrap;
  overflow: visible;
  text-overflow: unset;
  max-width: none;
  background: transparent;
  padding: 0;
  box-shadow: none;
  z-index: 10;
}

.preview-title {
  font-size: 2.2rem;
  font-weight: 800;
  color: #888;
  margin-bottom: 1.2rem;
  letter-spacing: -0.5px;
  padding: 0;
  display: block;
}

.blurred-name {
  opacity: 0.25;
  filter: blur(2px);
  color: #888;
}

.active-name {
  font-size: 2.8rem;
  font-weight: 900;
  color: #000;
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  display: inline-block;
}

.clickable-name {
  cursor: pointer;
  transition: all 0.2s ease;
}

.clickable-name:hover {
  opacity: 0.8;
  transform: translateX(4px);
}

.active-name:hover {
  transform: scale(1.05);
  background: rgba(0,0,0,0.05);
}
{% endstyle %}

<!-- Lightbox HTML -->
<div class="lightbox" id="imageLightbox">
  <span class="close-lightbox">&times;</span>
  <img class="lightbox-content" id="lightboxImage">
</div>

{% form 'contact', id:'CryptoContactForm' %}
<!-- Glove Selection Section -->
<div class="glove-selector-section">
  <h2 class="glove-selector-title">Select Your Gloves</h2>
  
  <div class="glove-options">
    <input type="radio" id="glove-pandora" name="contact[Glove]" value="Pandora's Box" checked>
    <label for="glove-pandora">Pandora's Box</label>
    
    <input type="radio" id="glove-vice" name="contact[Glove]" value="Vice">
    <label for="glove-vice">Vice</label>
    
    <input type="radio" id="glove-hedge" name="contact[Glove]" value="Hedge Maze">
    <label for="glove-hedge">Hedge Maze</label>
  </div>
  
  <!-- Image Gallery -->
  <div class="glove-gallery">
    <img id="glove-img-1" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_1.jpg?v=1750332619" alt="Pandora's Box 1">
    <img id="glove-img-2" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_2.jpg?v=1750332619" alt="Pandora's Box 2">
    <img id="glove-img-3" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_3.jpg?v=1750332619" alt="Pandora's Box 3">
    <img id="glove-img-4" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_4.jpg?v=1750332619" alt="Pandora's Box 4">
    <img id="accessories-img" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MMiamiDarrylFigurine_Accessories.jpg?v=1750332750" alt="Accessories">
  </div>
</div>

<!-- Delivery & Payment Sections -->
<div class="crypto-two-col">
  <!-- Delivery -->
  <div class="crypto-card">
    <h3>Delivery</h3>
    
    <div class="field field--2up">
      <div class="field">
        <input class="field__input" id="first_name" name="contact[First name]" required>
        <label for="first_name" class="field__label">First name</label>
      </div>
      <div class="field">
        <input class="field__input" id="last_name" name="contact[Last name]" required>
        <label for="last_name" class="field__label">Last name</label>
      </div>
    </div>
    
    <div class="field">
      <input class="field__input" id="email" type="email" name="contact[email]" required>
      <label for="email" class="field__label">Email</label>
    </div>
    
    <div class="field">
      <input class="field__input" id="street" name="contact[Street address]" required>
      <label for="street" class="field__label">Street address</label>
    </div>
    
  <div class="field">
  <input class="field__input" id="apt" name="contact[Apartment]" placeholder="Optional">
  <label for="apt" class="field__label">Apartment / suite (optional)</label>
</div>
    
    <div class="field field--2up">
      <div class="field">
        <input class="field__input" id="city" name="contact[City]" required>
        <label for="city" class="field__label">City</label>
      </div>
      <div class="field">
        <input class="field__input" id="postal" name="contact[Postal code]" required>
        <label for="postal" class="field__label">Postal code</label>
      </div>
    </div>
    
    <div class="field field--2up">
      <div class="field">
        <select class="field__input" id="country" name="contact[Country]" required>
          <option value="">Country</option>
          {% for c in all_country_option_tags %}{{ c }}{% endfor %}
        </select>
        <label for="country" class="field__label">Country</label>
      </div>
      <div class="field">
        <input class="field__input" id="region" name="contact[Region]" required>
        <label for="region" class="field__label">Region / State</label>
      </div>
    </div>
  </div>
  
  <!-- Payment -->
  <div class="crypto-card">
    <h3>Payment method</h3>
    
    <div class="field field--2up">
      <div class="field">
        <input class="field__input" id="qty" type="number" value="1" min="1" step="1" required>
        <label for="qty" class="field__label">Quantity</label>
      </div>
      <div class="field" style="pointer-events:none">
        <input class="field__input" id="amountField" value="$248" readonly>
        <label class="field__label">Amount to send</label>
      </div>
    </div>
    
    <div id="tokenGrid" class="btn-grid" style="margin-top:.8rem">
      <button class="pick-btn" data-token="USDC"><img src="{{ 'usdc.png' | file_url }}" alt="">USDC</button>
      <button class="pick-btn" data-token="USDT"><img src="{{ 'usdt.png' | file_url }}" alt="">USDT</button>
    </div>
    
    <div id="chainGrid" class="btn-grid hidden" style="margin-top:1.4rem"></div>
    
    <div id="walletPanel" class="wallet-panel">
      <div>
        <p class="addr-pill" id="walletAddr"></p>
        <button type="button" id="copyBtn" class="button button--secondary" style="margin-top:.6rem">Copy address</button>
        <span id="copyOk" style="margin-left:.6rem;color:green;display:none">Copied ✓</span>
      </div>
    </div>
    
    <input type="hidden" name="contact[Token]" id="chosenToken">
    <input type="hidden" name="contact[Chain]" id="chosenChain">
    <input type="hidden" name="contact[Quantity]" id="hiddenQty" value="1">
    <input type="hidden" name="contact[Total €]" id="hiddenTotal" value="248.00">
    
    <div class="field field--full" style="margin-top:1.4rem">
      <input class="field__input" id="txhash" name="contact[Tx hash]" required>
      <label for="txhash" class="field__label">Transaction ID / hash</label>
    </div>
    
    <button type="submit" class="button">Submit</button>
    
    <div class="crypto-warning hidden" id="cryptoWarning">
      <p>Please ensure you send the exact amount shown and cover any transaction fees on your end to avoid payment issues.</p>
    </div>
    
    {% if form.posted_successfully? %}
    <div id="formSuccessMsg" class="form-success">
      Valid Transaction ID. We will manually check your payment and you'll receive a confirmation email within 24 hours.
    </div>
    {% endif %}
  </div>
</div>
{% endform %}

<!-- Moved divider to top -->
<div id="figurine-viewer" style="margin: 4rem 0; font-family: 'Inter', sans-serif; position: relative;">
  <div class="section-divider">
    <h2 class="section-divider-title">Figure Skin Viewer</h2>
  </div>
  <!-- Glove Selector Pills -->
  <div class="glove-options product-form__input--pill" style="justify-content: center;">
    <input type="radio" id="glove-pandora-viewer" name="glove" value="pandora" checked>
    <label for="glove-pandora-viewer">Pandora's Box</label>

    <input type="radio" id="glove-vice-viewer" name="glove" value="vice">
    <label for="glove-vice-viewer">Vice</label>

    <input type="radio" id="glove-hedge-viewer" name="glove" value="hedge">
    <label for="glove-hedge-viewer">Hedge Maze</label>
  </div>

  <!-- Image Viewer -->
  <div id="viewer-container" class="viewer-container">
    <img id="viewer-img" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_1.jpg?v=1750332619" alt="Figurine Image" class="viewer-img" loading="eager" />
    <div class="viewer-controls">
      <button id="prevBtn" class="viewer-nav">← Previous</button>
      <span id="imageCounter">1 / 8</span>
      <button id="nextBtn" class="viewer-nav">Next →</button>
    </div>
  </div>

  <!-- Info Panel -->
  <div class="viewer-info-display">
    <div class="preview-title">View Figure With:</div>
    <span id="prevName" class="blurred-name clickable-name"></span>
    <span id="currentName" class="active-name clickable-name"></span>
    <span id="nextName" class="blurred-name clickable-name"></span>
  </div>
</div>

<script>
// Glove Images Configuration
const gloveImages = {
  "Pandora's Box": [
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_1.jpg?v=1750332619",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_2.jpg?v=1750332619",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_3.jpg?v=1750332619",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_4.jpg?v=1750332619"
  ],
  "Vice": [
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_ViceGloves_1.jpg?v=1750332554",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_ViceGloves_2.jpg?v=1750332554",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_ViceGloves_3.jpg?v=1750332554",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_ViceGloves_4.jpg?v=1750332554"
  ],
  "Hedge Maze": [
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_HedgeMaze_1.jpg?v=1750332352",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_HedgeMaze_2.jpg?v=1750332352",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_HedgeMaze_3.jpg?v=1750332352",
    "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_HedgeMaze_4.jpg?v=1750332352"
  ]
};

// Accessories image (same for all)
const accessoriesImage = "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MMiamiDarrylFigurine_Accessories.jpg?v=1750332750";

// Update glove images
function updateGloveImages(gloveType) {
  const images = gloveImages[gloveType];
  for (let i = 0; i < 4; i++) {
    document.getElementById(`glove-img-${i+1}`).src = images[i];
  }
  document.getElementById('accessories-img').src = accessoriesImage;
}

// Set up glove selection
document.querySelectorAll('.glove-options input[type="radio"]').forEach(input => {
  input.addEventListener('change', function() {
    if (this.checked) {
      updateGloveImages(this.value);
    }
  });
});

// Initialize with default
updateGloveImages("Pandora's Box");

// Lightbox functionality
const lightbox = document.getElementById('imageLightbox');
const lightboxImg = document.getElementById('lightboxImage');
const closeBtn = document.querySelector('.close-lightbox');

// Add click events to all images
document.querySelectorAll('.glove-image').forEach(img => {
  img.addEventListener('click', function() {
    lightboxImg.src = this.src;
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden'; // Prevent scrolling
  });
});

// Close lightbox
closeBtn.addEventListener('click', function() {
  lightbox.classList.remove('active');
  document.body.style.overflow = 'auto';
});

// Close when clicking outside image
lightbox.addEventListener('click', function(e) {
  if (e.target === lightbox) {
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
  }
});

// Close with ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && lightbox.classList.contains('active')) {
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
  }
});

// Crypto Payment Configuration
const UNIT_EUR = 248.00;
const ADDR = {
  USDC: {
    ETH: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2',
    TRON: 'TYD6BPyEX5QNy2hNMm9Q3Ki6g2vACB8DUs',
    BSC: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2',
    SOL: 'pzDQK34wXwZFyzvGLi8Ms6YEYN8n5P7GsznZQRYNdgj',
    POLY: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2'
  },
  USDT: {
    ETH: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2',
    TRON: 'TYD6BPyEX5QNy2hNMm9Q3Ki6g2vACB8DUs',
    BSC: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2',
    SOL: 'pzDQK34wXwZFyzvGLi8Ms6YEYN8n5P7GsznZQRYNdgj',
    POLY: '0xDF2E50c1BF77Efa103e80053795d61F1D65fE5C2'
  }
};
const CHAINS = {ETH: 'Ethereum', TRON: 'TRON', BSC: 'BSC', SOL: 'Solana', POLY: 'Polygon'};
const ICONS = {ETH: "{{ 'eth.png' | file_url }}", TRON: "{{ 'tron.png'|file_url }}", BSC: "{{ 'bsc.png'|file_url }}", SOL: "{{ 'solana.png'|file_url }}", POLY: "{{ 'polygon.png'|file_url }}"};

// DOM Elements
const qtyInput = document.getElementById('qty');
const amtField = document.getElementById('amountField');
const hiddenQty = document.getElementById('hiddenQty');
const hiddenTot = document.getElementById('hiddenTotal');
const tokenGrid = document.getElementById('tokenGrid');
const chainGrid = document.getElementById('chainGrid');
const panel = document.getElementById('walletPanel');
const addrEl = document.getElementById('walletAddr');
const copyBtn = document.getElementById('copyBtn');
const copyOk = document.getElementById('copyOk');
const chosenToken = document.getElementById('chosenToken');
const chosenChain = document.getElementById('chosenChain');
const txField = document.getElementById('txhash');
const form = document.getElementById('CryptoContactForm');
let currentAddr = '';

// Functions
function updateTotal() {
  const q = Math.max(1, parseInt(qtyInput.value || '1', 10));
  const total = (q * UNIT_EUR).toFixed(2);
  amtField.value = `${total} $`;
  hiddenQty.value = q;
  hiddenTot.value = total;
}

function buildChains(token) {
  chainGrid.innerHTML = '';
  Object.keys(ADDR[token]).forEach(chain => {
    chainGrid.insertAdjacentHTML('beforeend', `
      <button class="pick-btn" data-chain="${chain}">
        <img src="${ICONS[chain]}" alt="">${CHAINS[chain]}
      </button>`);
  });
}

// Event Listeners
qtyInput.addEventListener('input', updateTotal);
updateTotal();

tokenGrid.addEventListener('click', e => {
  const btn = e.target.closest('.pick-btn');
  if (!btn) return;
  [...tokenGrid.children].forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  buildChains(btn.dataset.token);
  chainGrid.classList.remove('hidden');
  panel.classList.remove('show');
  chosenToken.value = btn.dataset.token;
  chosenChain.value = '';
});

chainGrid.addEventListener('click', e => {
  const btn = e.target.closest('.pick-btn');
  if (!btn) return;
  [...chainGrid.children].forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  
  const token = chosenToken.value;
  const chain = btn.dataset.chain;
  currentAddr = ADDR[token][chain];
  
  addrEl.textContent = currentAddr;
  panel.classList.add('show');
  chosenChain.value = CHAINS[chain];
  copyOk.style.display = 'none';
  document.getElementById('cryptoWarning').classList.remove('hidden');
});

copyBtn.addEventListener('click', async () => {
  if (!currentAddr) return;
  await navigator.clipboard.writeText(currentAddr);
  copyOk.style.display = 'inline';
});

// Clear success message on refresh
window.addEventListener('load', function() {
  if (window.performance && window.performance.getEntriesByType("navigation")[0].type === "reload") {
    const msg = document.getElementById('formSuccessMsg');
    if (msg) msg.remove();
  }
});

// Skin Viewer Script
document.addEventListener('DOMContentLoaded', function () {
  const gloves = {
    vice: ["Vice Gloves", "AWP | Fade", "AK-47 | Gold Arabesque", "M4A1-S | Hot Rod", "M4A1-S | Blue Phosphor", "★ Karambit | Ruby", "★ Karambit | Emerald", "★ M9 Bayonet | Sapphire"],
    pandora: ["Pandora's Box Gloves", "AWP | Fade", "AK-47 | Gold Arabesque", "M4A1-S | Hot Rod", "M4A1-S | Blue Phosphor", "★ Karambit | Ruby", "★ Karambit | Emerald", "★ M9 Bayonet | Sapphire"],
    hedge: ["Hedge Maze Gloves", "AWP | Fade", "AK-47 | Gold Arabesque", "M4A1-S | Hot Rod", "M4A1-S | Blue Phosphor", "★ Karambit | Ruby", "★ Karambit | Emerald", "★ M9 Bayonet | Sapphire"]
  };

  const urls = {
    vice: [
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_ViceGloves_1.jpg?v=1750332554",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_fade.jpg?v=1749907969",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_arabesque.jpg?v=1749907724",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_hotrod.jpg?v=1749907940",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_bluephosphor.jpg?v=1749907774",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_ruby.jpg?v=1749907792",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_emerald.jpg?v=1749908821",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/vice_sapphire.jpg?v=1750008665"
    ],
    pandora: [
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_1.jpg?v=1750332619",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_fade.jpg?v=1749907926",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_arabesque.jpg?v=1749918916",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_hotrod.jpg?v=1749907952",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_bluephosphor.jpg?v=1749907839",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_ruby.jpg?v=1749908644",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_emerald.jpg?v=1749907913",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/pandora_sapphire.jpg?v=1750008691"
    ],
    hedge: [
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_HedgeMaze_1.jpg?v=1750332352",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_fade.jpg?v=1749907822",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_arabesque.jpg?v=1749907808",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_hotrod.jpg?v=1749908427",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_bluephosphor.jpg?v=1749907985",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_ruby.jpg?v=1749908002",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_emerald.jpg?v=1749908692",
      "https://cdn.shopify.com/s/files/1/0745/6482/9415/files/hedge_sapphire.jpg?v=1750008689"
    ]
  };

  let currentGlove = 'pandora';
  let currentSet = urls[currentGlove];
  let nameSet = gloves[currentGlove];
  let index = 0;

  const viewerImg = document.getElementById('viewer-img');
  const imageCounter = document.getElementById('imageCounter');
  const currentName = document.getElementById('currentName');
  const prevName = document.getElementById('prevName');
  const nextName = document.getElementById('nextName');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  function updateImage() {
    viewerImg.classList.add('animate');
    setTimeout(() => {
      viewerImg.src = currentSet[index];
      viewerImg.onload = () => viewerImg.classList.remove('animate');
      imageCounter.textContent = `${index + 1} / ${currentSet.length}`;
      currentName.textContent = nameSet[index];
      prevName.textContent = index > 0 ? nameSet[index - 1] : '';
      nextName.textContent = index < currentSet.length - 1 ? nameSet[index + 1] : '';
      prevBtn.disabled = (index === 0);
      nextBtn.disabled = (index === currentSet.length - 1);
    }, 150);
  }

  function handleNameClick(clickedIndex) {
    index = clickedIndex;
    updateImage();
  }

  document.querySelectorAll('input[name="glove"]').forEach(input => {
    input.addEventListener('change', function () {
      if (this.checked) {
        currentGlove = this.value;
        currentSet = urls[currentGlove];
        nameSet = gloves[currentGlove];
        index = 0;
        updateImage();
      }
    });
  });

  prevBtn.addEventListener('click', function () {
    if (index > 0) {
      index--;
      updateImage();
    }
  });

  nextBtn.addEventListener('click', function () {
    if (index < currentSet.length - 1) {
      index++;
      updateImage();
    }
  });

  // Add click handlers for the name elements
  prevName.addEventListener('click', function() {
    if (index > 0) {
      handleNameClick(index - 1);
    }
  });
  
  currentName.addEventListener('click', function() {
    handleNameClick(index);
  });
  
  nextName.addEventListener('click', function() {
    if (index < currentSet.length - 1) {
      handleNameClick(index + 1);
    }
  });

  updateImage();
});
</script>