{% comment %}
  Product Page Template for Shopify
  Place this file in your theme's templates folder as product.liquid
{% endcomment %}

<div class="glove-layout-wrapper">
  <div class="glove-column">
    <div class="product-header">
      <div class="product-info-box">
        <h1 class="product-title">Sir Bloody Miami Darryl Figure</h1>
        <div class="product-price">$278.00 USD</div>
        <div class="free-delivery-message">Free Shipping On All Orders</div>
      </div>
    </div>

    <div class="glove-options product-form__input--pill">
      <input type="radio" id="glove-pandora" name="glove" value="pandora" checked>
      <label for="glove-pandora">Pandora's Box</label>
      <input type="radio" id="glove-vice" name="glove" value="vice">
      <label for="glove-vice">Vice</label>
      <input type="radio" id="glove-hedge" name="glove" value="hedge">
      <label for="glove-hedge">Hedge Maze</label>
    </div>

    <div class="quantity-selector">
      <div class="quantity-label">Quantity</div>
      <div class="quantity-controls">
        <button type="button" class="quantity-btn" id="qty-decrease" disabled>−</button>
        <span        class="quantity-value" id="qty-value">1</span>
        <button type="button" class="quantity-btn" id="qty-increase">+</button>
      </div>
    </div>

    <div class="preorder-buttons">
      <button class="btn-preorder">Pre-Order</button>
      <button class="btn-crypto">Pre-Order With Crypto &amp; Save $30</button>
    </div>

    <div class="limited-edition-badge">
      <div class="limited-flash">
        <span class="gold-star">★</span>
        <span class="limited-text">LIMITED EDITION</span>
      </div>
      <div class="subtext">
        Only 1000 will ever exist, each marked with a unique number.
      </div>
    </div>
  </div>

  <div class="glove-viewer">
    <div id="viewer-container" class="viewer-container">
      <img id="viewer-img" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MiamiDarrylFigurine_PandorasBox_1.jpg?v=1750332619" alt="Figurine Image" class="viewer-img" loading="eager" />
      <div class="viewer-controls">
        <button id="prevBtn" class="overlay-nav arrow-left"  aria-label="Previous image">‹</button>
        <button id="nextBtn" class="overlay-nav arrow-right" aria-label="Next image">›</button>
        <div id="dotContainer" class="dot-container"></div>
      </div>
    </div>

    <div class="viewer-info-container">
      <div class="viewer-info-display">
        <div class="preview-title">View Figure With:</div>
        <span id="prevName" class="blurred-name clickable-name"></span>
        <span id="currentName" class="active-name clickable-name"></span>
        <span id="nextName" class="blurred-name clickable-name"></span>
      </div>

      <div class="figure-info">
        <div class="figure-text">Figure Includes All Accessories</div>
        <img id="accessory-img" class="glove-image" src="https://cdn.shopify.com/s/files/1/0745/6482/9415/files/MMiamiDarrylFigurine_Accessories_1.jpg?v=1750332832" />
      </div>
    </div>

    <div id="lightbox" class="lightbox">
      <span class="close-lightbox" onclick="closeLightbox()">×</span>
      <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="Large View" />
        <div class="lightbox-instruction">← Use Arrow Keys →</div>
      </div>
    </div>
  </div>
</div>

<style>
.glove-layout-wrapper {
  display: flex;
  flex-direction: column;
  gap: 3rem;
  max-width: 1100px;
  margin: 3rem auto 0 auto;
  padding: 0 3vw;
}
@media (min-width: 900px) {
  .glove-layout-wrapper {
    flex-direction: row;
    align-items: flex-start;
    gap: 4rem;
  }
  .glove-column { flex: 1.1; }
  .glove-viewer { flex: 1.2; }
}
.product-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #221a38;
  padding: 2rem 3vw 1.5rem 3vw;
  border-bottom: 1px solid #2d2346;
  position: sticky;
  top: 0;
  z-index: 10;
}
.product-header .product-info-box {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
}
.product-header .product-info-box .product-title {
  font-size: 2.3rem;
  font-weight: 700;
  color: #fff;
}
.product-header .product-info-box .product-price {
  font-size: 2.1rem;
  font-weight: 700;
  color: #a259ec;
}
.product-header .product-info-box .free-delivery-message {
  font-size: 1.15rem;
  color: #b8b3d1;
}
.glove-options {
  display: flex;
  gap: 0.7rem;
  margin-bottom: 1.2rem;
}
.glove-options input[type="radio"] {
  display: none;
}
.glove-options label {
  background: #18122b;
  color: #f3f0ff;
  padding: 0.9rem 2.2rem;
  border-radius: 8px;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 1.1rem;
  border: 1.5px solid #2d2346;
  cursor: pointer;
  transition: border 0.18s;
}
.glove-options label:hover {
  border: 1.5px solid #a259ec;
}
.glove-options input[type="radio"]:checked + label {
  background: #a259ec;
  color: #fff;
  border: 1.5px solid #a259ec;
}
.quantity-selector {
  margin-bottom: 1.2rem;
}
.quantity-label {
  font-size: 1.1rem;
  font-weight: 600;
  color: #f3f0ff;
  margin-bottom: 0.4rem;
}
.quantity-controls {
  display: flex;
  gap: 0.7rem;
}
.quantity-btn {
  width: 44px;
  height: 44px;
  border-radius: 10px;
  background: #18122b;
  color: #f3f0ff;
  border: 1.5px solid #2d2346;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: border 0.18s, background 0.18s, color 0.18s;
}
.quantity-btn.selected, .quantity-btn:hover {
  background: #a259ec;
  color: #fff;
  border: 1.5px solid #a259ec;
}
.preorder-buttons {
  display: flex;
  gap: 1.2rem;
  margin-bottom: 1.2rem;
}
.btn-preorder, .btn-crypto {
  flex: 1;
  padding: 1.1rem 0;
  border-radius: 10px;
  font-size: 1.15rem;
  font-weight: 700;
  border: none;
  background: #a259ec;
  color: #fff;
  box-shadow: 0 2px 8px #a259ec33;
  cursor: pointer;
  transition: background 0.18s, box-shadow 0.18s;
}
.btn-preorder:hover, .btn-crypto:hover {
  background: #7c3aed;
  box-shadow: 0 4px 16px #7c3aed33;
}
.limited-edition-badge {
  background: #a259ec22;
  color: #a259ec;
  font-weight: 700;
  font-size: 1.1rem;
  padding: 0.5rem 1.2rem;
  border-radius: 999px;
  display: inline-block;
  margin-bottom: 0.7rem;
}
.glove-viewer {
  background: #221a38;
  border-radius: 18px;
  box-shadow: 0 2px 16px #0003;
  padding: 2.5rem 2rem 2rem 2rem;
  border: 1.5px solid #2d2346;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}
.viewer-container {
  position: relative;
}
.viewer-img {
  width: 100%;
  border-radius: 18px;
  background: #221a38;
  box-shadow: 0 4px 32px #0002;
  border: 2px solid #2d2346;
  margin-bottom: 1.2rem;
}
.viewer-controls {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 1rem;
}
.overlay-nav {
  background: none;
  border: none;
  font-size: 2rem;
  color: #fff;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.18s;
}
.overlay-nav:hover {
  opacity: 1;
}
.dot-container {
  display: flex;
  gap: 0.7rem;
  margin-top: 0.5rem;
}
.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #2d2346;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.18s;
}
.dot.selected, .dot:hover {
  opacity: 1;
}
.viewer-info-container {
  background: #221a38;
  border-radius: 18px;
  box-shadow: 0 2px 16px #0003;
  padding: 2.5rem 2rem 2rem 2rem;
  border: 1.5px solid #2d2346;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}
.viewer-info-display {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
}
.preview-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #f3f0ff;
}
.blurred-name, .active-name, .clickable-name {
  font-size: 1.1rem;
  color: #b8b3d1;
}
.figure-info {
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
}
.figure-text {
  font-size: 1.1rem;
  color: #b8b3d1;
}
.glove-image {
  width: 100%;
  border-radius: 8px;
  background: #221a38;
  box-shadow: 0 4px 32px #0002;
  border: 2px solid #2d2346;
  margin-top: 0.7rem;
}
.lightbox {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1000;
}
.lightbox-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 18px;
  padding: 2rem;
  max-width: 80%;
  max-height: 80%;
}
.close-lightbox {
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-size: 2rem;
  color: #fff;
  cursor: pointer;
}
.lightbox-instruction {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1.1rem;
  color: #fff;
}
@media (max-width: 900px) {
  .glove-layout-wrapper { flex-direction: column; }
  .glove-column, .glove-viewer { width: 100%; }
}
</style>

<script>
const productImages = [
  {% for image in product.images %}
  { url: "{{ image | img_url: '800x800' }}", alt: "{{ image.alt | default: product.title | escape }}" }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];
let currentImageIndex = 0;
function setCurrentImage(index) {
  currentImageIndex = index;
  const mainImage = document.getElementById('viewer-img');
  if (mainImage && productImages[currentImageIndex]) {
    mainImage.src = productImages[currentImageIndex].url;
    mainImage.alt = productImages[currentImageIndex].alt;
  }
  document.querySelectorAll('.dot').forEach((dot, idx) => {
    if (idx === index) dot.classList.add('selected');
    else dot.classList.remove('selected');
  });
}
const productVariants = [
  {% for variant in product.variants %}
  {
    id: {{ variant.id }},
    price: {{ variant.price }},
    compare_at_price: {{ variant.compare_at_price | default: 0 }},
    available: {{ variant.available | json }},
    title: "{{ variant.title | escape }}",
    options: [ {% for option in variant.options %}"{{ option | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %} ]
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];
let selectedQuantity = 1;
let currentVariant = productVariants[0];
function setQuantity(quantity) {
  selectedQuantity = quantity;
  document.getElementById('qty-value').textContent = quantity;
  document.querySelectorAll('.quantity-btn').forEach(btn => {
    const btnQuantity = parseInt(btn.textContent);
    if (btnQuantity === quantity) btn.classList.add('selected');
    else btn.classList.remove('selected');
  });
}
function updateSelectedVariant() {
  const selectedOptions = [];
  document.querySelectorAll('.glove-options input[type="radio"]:checked').forEach(input => {
    selectedOptions[input.id.split('-')[1]] = input.value;
  });
  const matchingVariant = productVariants.find(variant => {
    return variant.options.every((option, index) => option === selectedOptions[index]);
  });
  if (matchingVariant) {
    currentVariant = matchingVariant;
    const priceElement = document.getElementById('variant-price');
    const comparePriceElement = document.getElementById('variant-compare-price');
    if (priceElement) {
      priceElement.textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: '{{ cart.currency.iso_code }}' }).format(matchingVariant.price / 100);
    }
    if (comparePriceElement && matchingVariant.compare_at_price > matchingVariant.price) {
      comparePriceElement.textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: '{{ cart.currency.iso_code }}' }).format(matchingVariant.compare_at_price / 100);
      comparePriceElement.style.display = 'inline';
    } else if (comparePriceElement) {
      comparePriceElement.style.display = 'none';
    }
    const addToCartBtn = document.querySelector('.btn-preorder');
    const addToCartText = document.querySelector('.btn-preorder');
    const buyNowBtn = document.querySelector('.btn-crypto');
    if (matchingVariant.available) {
      addToCartBtn.disabled = false;
      buyNowBtn.disabled = false;
      addToCartText.textContent = 'Pre-Order';
      addToCartBtn.classList.remove('disabled');
      buyNowBtn.classList.remove('disabled');
    } else {
      addToCartBtn.disabled = true;
      buyNowBtn.disabled = true;
      addToCartText.textContent = 'Sold Out';
      addToCartBtn.classList.add('disabled');
      buyNowBtn.classList.add('disabled');
    }
  }
}
function buyNow() {
  if (!currentVariant.available) return;
  const form = document.querySelector('.glove-layout-wrapper');
  fetch('/cart/add.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id: currentVariant.id, quantity: selectedQuantity })
  })
  .then(response => response.json())
  .then(data => { window.location.href = '/checkout'; })
  .catch(error => { alert('There was an error adding the product to cart.'); });
}
document.addEventListener('DOMContentLoaded', function() {
  setCurrentImage(0);
  setQuantity(1);
  updateSelectedVariant();
  document.querySelectorAll('.glove-options input[type="radio"]').forEach(input => {
    input.addEventListener('change', updateSelectedVariant);
  });
});
</script>
